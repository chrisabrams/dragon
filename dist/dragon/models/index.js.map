{"version":3,"sources":["../../../src/dragon/models/index.js"],"names":["Model","attr","options","uid","uniqueId","eventEmitter","emit","emitEvent","bind","on","addListener","once","addOnceListener","off","removeListener","defaults","disposed","url","Object","defineProperty","configurable","enumerable","writable","changes","add","del","update","forEach","change","type","push","length","object","index","props","keys","result","Array","key","value","obj","iteratee","keyInObj","i","context","indexOf","pick","baseValues","collection","Math","pow","isArrayLike","_","isArray","isString","isArguments","keysChanged","silent","dispose","prototype","mixin"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n\n/**\n * Module Dependencies\n *\n * @ignore\n */\nimport EventEmitter      from '../events'\nimport mixin             from '../mixin'\nimport utils             from '../utils'\n\n/**\n * Model Class\n *\n * @public\n * @class Model\n */\nclass Model {\n\n  constructor(attr = {}, options = {}) {\n    this.uid = utils.uniqueId(this)\n\n    // TODO: figure out how to mixin this\n    var eventEmitter = new EventEmitter()\n\n    this.emit  = eventEmitter.emitEvent.bind(eventEmitter)\n    this.on    = eventEmitter.addListener.bind(eventEmitter)\n    this.once  = eventEmitter.addOnceListener.bind(eventEmitter)\n    this.off   = eventEmitter.removeListener.bind(eventEmitter)\n\n    this.defaults = {}\n\n    this.disposed = false\n\n    this.url = ''\n\n    this.options = options\n\n    Object.defineProperty(this, 'attr', {\n      configurable: false,\n      enumerable: true,\n      writable: true\n    })\n\n    this.attr = Object.assign({}, this.defaults, attr)\n\n    //this.observeAttributes()\n  }\n\n  /*\n  TODO: not the full appr\n  */\n  clear() {\n\n    this.attr = {}\n    this.emit('change')\n\n  }\n\n  getData() {\n    return Object.assign({}, this.attr)\n  }\n\n  /*\n  TODO: add an an unobserve option\n  */\n  observeAttributes() {\n\n    // Trigger changes on model\n    //Object.observe(this.attr, this.observeHandler.bind(this))\n\n  }\n\n  observeHandler(changes) {\n\n    //this.emit('change', changes)\n\n    /*\n    TODO: consider making this a mixin and expanding to watch specific properties\n    */\n\n    var add    = [],\n        del    = [],\n        update = []\n\n    changes.forEach( (change) => {\n\n      switch(change.type) {\n\n        case 'add'    : add.push(change); break;\n        case 'delete' : del.push(change); break;\n        case 'update' : update.push(change); break;\n\n      }\n\n    })\n\n    if(add.length > 0)    this.emit('add', add)\n    if(del.length > 0)    this.emit('delete', del)\n    if(update.length > 0) this.emit('update', update)\n\n  }\n\n  /*\n  TODO: Undecided on appraoch for sync/fetch/save/etc.\n  */\n  sync() {\n\n  }\n\n  toJSON() {\n\n    return JSON.stringify(this.attr)\n\n  }\n\n  pairs(object = this.attr) {\n    var index = -1,\n    props = this.keys(object),\n    length = props.length,\n    result = Array(length);\n    while (++index < length) {\n      let key = props[index];\n      result[index] = [key, object[key]];\n    }\n    return result;\n  }\n\n  // Internal pick helper function to determine if `obj` has key `key`.\n  keyInObj(value, key, obj) {\n    return key in obj;\n  }\n\n  // Return a copy of the object only containing the whitelisted properties.\n  pick(...keys) {\n    var obj=this.attr,result = {}, iteratee = keys[0];\n    if (obj == null) return result;\n    if (typeof iteratee === 'function') {\n      if (keys.length > 1) iteratee = iteratee; //TODO optimized callback for enable context\n      keys = this.keys(obj); //not working in inherited properties keys\n    } else {\n      iteratee = this.keyInObj;\n      obj = Object(obj);\n    }\n    for (var i = 0, length = keys.length; i < length; i++) {\n      var key = keys[i];\n      var value = obj[key];\n      if (iteratee(value, key, obj)) result[key] = value;\n    }\n    return result;\n  }\n\n  // Return a copy of the object without the blacklisted properties.\n  omit(...keys) {\n    var obj=this.attr,iteratee = keys[0], context;\n    if (typeof iteratee === 'function') {\n      iteratee = iteratee;\n      if (keys.length > 1) context = keys[1];\n    } else {\n      iteratee = function(value, key, obj) {\n        return keys.indexOf(key) == -1;\n      };\n    }\n    return this.pick(iteratee, context);\n  }\n\n  baseValues(object , props) {\n    var index = -1,\n    length = props.length,\n    result = Array(length);\n\n    while (++index < length) {\n      result[index] = object[props[index]];\n    }\n    return result;\n  }\n\n  values(object = this.attr) {\n    return this.baseValues(object, this.keys(object));\n  }\n\n  keys(object = this.attr){\n    return Object.keys(object);\n  }\n\n  // Invert the keys and values of an object. The values must be serializable.\n  invert(obj = this.attr) {\n    var result = {},\n    index = -1,\n    props = this.keys(obj),\n    length = props.length;\n\n    while (++index < length) {\n      result[obj[props[index]]] = props[index];\n    }\n    return result;\n  }\n\n  isArrayLike(collection) {\n    var length = collection[length];\n    return typeof length == 'number' && length >= 0 && length <= (Math.pow(2, 53) - 1);\n  };\n\n  isEmpty(value = this.attr) {\n    if (value == null) return true;\n    if (isArrayLike(value) && (_.isArray(value) || _.isString(value) || _.isArguments(value))) return value.length === 0;\n    return this.keys(value).length === 0;\n  }\n\n  set(obj, options = {}) {\n\n    var keysChanged = []\n    Object.keys(obj).forEach((key) => {\n\n      this.attr[key] = obj[key]\n      keysChanged.push(key)\n\n    })\n\n    // Don't emit a change event if silence is requested\n    if(options.silent) return\n    this.emit('change', keysChanged)\n  }\n\n  dispose(options = {}) {\n\n    utils.dispose(this, options)\n\n  }\n\n}\n\nObject.assign(Model.prototype, {mixin})\n\nexport default Model\n"]}