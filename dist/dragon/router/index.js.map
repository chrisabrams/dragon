{"version":3,"sources":["../../../src/dragon/router/index.js"],"names":["Router","options","uid","uniqueId","eventEmitter","emit","emitEvent","bind","on","addListener","once","addOnceListener","off","removeListener","_currentHandler","_currentUrl","_debug","debug","_history","window","history","_location","location","_routes","_started","desposed","routes","console","error","loadRoutes","document","addEventListener","onLinkClick","back","disposed","stop","removeEventListener","dispose","forward","pattern","route","push","pathname","el","href","getAttribute","rel","charAt","indexOf","path","replace","title","onUrlChange","e","target","nodeName","isIgnoredLink","preventDefault","navigate","matched","getPath","i","l","length","item","regExp","test","params","extractParams","_usePushState","prototype","mixin","Route"],"mappings":"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","file":"index.js","sourcesContent":["'use strict'\n\n/**\n * Module Dependencies\n *\n * @ignore\n */\nimport EventEmitter from '../events'\nimport mixin       from '../mixin'\nimport Route       from './route'\nimport utils       from '../utils'\n\n/**\n * Router Class\n *\n * @public\n * @class Router\n */\nclass Router {\n\n  constructor(options = {}) {\n    this.uid = utils.uniqueId(this)\n\n    // TODO: figure out how to mixin this\n    var eventEmitter = new EventEmitter()\n\n    this.emit  = eventEmitter.emitEvent.bind(eventEmitter)\n    this.on    = eventEmitter.addListener.bind(eventEmitter)\n    this.once  = eventEmitter.addOnceListener.bind(eventEmitter)\n    this.off   = eventEmitter.removeListener.bind(eventEmitter)\n\n    this._currentHandler = null\n    this._currentUrl     = null\n    this._debug          = options.debug || false\n    this._history        = window.history\n    this._location       = window.location\n    this._routes         = []\n    this._started        = false\n\n    this.desposed = false\n\n    this.options = options\n\n    if(!this.options.routes) return console.error('Router needs routes')\n    this.loadRoutes()\n\n    document.addEventListener('click', this.onLinkClick.bind(this), false)\n\n  }\n\n  back() {\n    window.history.back()\n  }\n\n  dispose() {\n\n    if(!this.disposed) {\n\n      this.stop()\n\n      document.removeEventListener('click', this.onLinkClick, false)\n\n      utils.dispose(this)\n\n    }\n\n  }\n\n  forward() {\n    window.history.forward()\n  }\n\n  get(pattern, options = {}) {\n\n    var route = new Route(pattern)\n\n    this._routes.push({route, options})\n\n    /*let forwardPath = arguments[1]\n\n    // Forward route\n    if(typeof forwardPath == 'string') {\n\n      this.navigate(forwardPath)\n      return\n    }\n\n    return this.router.get(path, (req, next) => {\n\n      this.currentHandler = handler\n\n      handler.call(this.router, req, next)\n\n    })*/\n\n  }\n\n  getPath() {\n\n    //path.charAt(0) === '/' ? path.slice(1) : path;\n    return window.location.pathname\n\n  }\n\n  isIgnoredLink(el) {\n\n    var href = el.getAttribute('href'),\n        rel  = el.getAttribute('rel')\n\n    if(!href || href == '' || href.charAt(0) == '#' || (rel && rel == 'external') || href.indexOf('//') > -1) return true\n\n    return false\n\n  }\n\n  loadRoutes() {\n\n    this.options.routes(this)\n\n  }\n\n  navigate(path, options = {}) {\n\n    this._history[options.replace ? 'replaceState' : 'pushState']({}, document.title, path)\n    this.onUrlChange()\n\n  }\n\n  onLinkClick(e) {\n\n    var el = e.target\n\n    if(el.nodeName == 'A') {\n\n      if(this.isIgnoredLink(el)) return\n\n      /*if(external) {\n        window.open(href)\n      }*/\n\n      e.preventDefault()\n\n      this.navigate(el.href)\n\n    }\n\n  }\n\n  onUrlChange() {\n\n    var matched = false,\n        path    = this.getPath()\n\n    for(var i = 0, l = this._routes.length; i < l; i++) {\n\n      var item    = this._routes[i],\n          options = item.options,\n          route   = item.route\n\n      if(route.regExp.test(path)) {\n\n        var params = route.extractParams(path)\n\n        this.emit('match', route, params, options)\n        matched = true\n\n        break\n      }\n\n    }\n\n  }\n\n  start(options = {}) {\n\n    if(this._started) return console.error('Router already started.')\n\n    this._started = true\n\n    this._usePushState = true\n\n    window.addEventListener('popstate', this.onUrlChange.bind(this), false)\n\n    // popstate doesn't fire on page load\n    this.onUrlChange()\n\n  }\n\n  stop() {\n\n    if(!this._started) return\n\n    window.removeEventListener('popstate', this.onUrlChange, false)\n\n    this._started = false\n\n  }\n\n  use() {\n\n\n\n  }\n\n}\n\nObject.assign(Router.prototype, {mixin})\n\nexport {Route}\n\nexport default Router\n"]}